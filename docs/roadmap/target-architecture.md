# –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Secretary Bot

> –î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ü–µ–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ Secretary Bot --
> –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–≥–æ AI-—Å–µ–∫—Ä–µ—Ç–∞—Ä—è —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏ Google Calendar, Gmail,
> Google Drive/Docs —á–µ—Ä–µ–∑ MCP, Yandex SpeechKit, Claude API –∏ —Å–∏—Å—Ç–µ–º–æ–π –±–∏–ª–ª–∏–Ω–≥–∞.
>
> **–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
> - Google —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ MCP-—Å–µ—Ä–≤–µ—Ä—ã Claude (–Ω–µ –ø—Ä—è–º—ã–µ API –≤—ã–∑–æ–≤—ã)
> - –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: Telegram, Web, Mobile, API
> - Platform ‚Üí Core ‚Üí Services layered pattern
>
> **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-02-12

---

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–¶–µ–ª–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Ü–µ–ª–µ–≤–∞—è-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω: Platform - Core - Services](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π-–ø–∞—Ç—Ç–µ—Ä–Ω-platform--core--services)
3. [–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ API endpoints (REST API v1)](#–ø–æ–ª–Ω—ã–π-—Å–ø–∏—Å–æ–∫-api-endpoints-rest-api-v1)
4. [–í—Å–µ –º–æ–¥–µ–ª–∏ –ë–î (14 —à—Ç—É–∫)](#–≤—Å–µ-–º–æ–¥–µ–ª–∏-–±–¥-14-—à—Ç—É–∫)
5. [–§–æ—Ä–º–∞—Ç API –æ—Ç–≤–µ—Ç–æ–≤](#—Ñ–æ—Ä–º–∞—Ç-api-–æ—Ç–≤–µ—Ç–æ–≤)

---

## –¶–µ–ª–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
secretary/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îú‚îÄ‚îÄ ci.yml                    # GitHub Actions: lint, test, build
‚îÇ       ‚îî‚îÄ‚îÄ deploy.yml                # CD pipeline
‚îÇ
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile                    # Multi-stage production build
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile.dev                # Development —Å hot reload
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml            # Production (app + postgres + redis)
‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.dev.yml        # Development
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js                  # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (zod –≤–∞–ª–∏–¥–∞—Ü–∏—è)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.js               # Sequelize –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è CLI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.js                 # Winston singleton (console + file)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ constants.js              # –†–æ–ª–∏, —Å—Ç–∞—Ç—É—Å—ã, –ª–∏–º–∏—Ç—ã, –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js                  # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π + –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ User.js                   # +password_hash, +telegram_id, +timezone, +language,
‚îÇ   ‚îÇ   ‚îÇ                             #  +subscription_tier, +is_active
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Employee.js               # (legacy, —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ª–∏—è–Ω–∏–µ —Å User)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Event.js                  # +user_id (—è–≤–Ω—ã–π FK), +recurrence_rule, +reminder_minutes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Task.js                   # +priority(ENUM), +tags(ARRAY), +reminder_at
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Note.js                   # +user_id (FK!), +category
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Session.js                # +platform(ENUM), +metadata(JSONB)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Message.js                # function_call -> tool_calls, +token_count, +model_used
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Summary.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Contact.js                # CRM: name, company, position, email, phone, tags
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Interaction.js            # CRM: contact_id, type, summary, follow_up
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Subscription.js           # tier, status, stripe_id, period_start/end
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Payment.js                # amount, currency, status, provider, provider_id
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CreditTransaction.js      # type, amount, balance_after, model_used, tokens
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OAuthToken.js             # user_id, provider, access/refresh_token(encrypted), expires_at
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ migrations/                   # Sequelize CLI –º–∏–≥—Ä–∞—Ü–∏–∏ (–æ–¥–Ω–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É/–∏–∑–º–µ–Ω–µ–Ω–∏–µ)
‚îÇ   ‚îú‚îÄ‚îÄ seeders/                      # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js                   # JWT –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è + requireRole()
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rateLimiter.js            # Rate limiting (–≥–ª–æ–±–∞–ª—å–Ω—ã–π + per-user –ø–æ —Ç–∞—Ä–∏—Ñ—É)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validator.js              # Zod schema validation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errorHandler.js           # –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ requestLogger.js          # HTTP request logging
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js                  # –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.routes.js            # /auth/register, /auth/login, /auth/refresh, /auth/telegram
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.routes.js           # /users/me
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ events.routes.js          # CRUD + /events/today + /events/range
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks.routes.js           # CRUD + /tasks/:id/status
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notes.routes.js           # CRUD + /notes/:id/complete
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contacts.routes.js        # CRM CRUD + interactions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sessions.routes.js        # –°–µ—Å—Å–∏–∏ —á–∞—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ billing.routes.js         # –ü–æ–¥–ø–∏—Å–∫–∏, checkout, webhook
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ integrations.routes.js    # OAuth callbacks
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ health.routes.js          # Health + readiness
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ controllers/                  # –ü–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–∞–∂–¥—ã–π routes —Ñ–∞–π–ª
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.controller.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ events.controller.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks.controller.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notes.controller.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contacts.controller.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sessions.controller.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ billing.controller.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ integrations.controller.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ health.controller.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ claudeHandler.js      # Claude API (–∑–∞–º–µ–Ω–∞ chatgptHandler)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ intentParser.js       # –ü–∞—Ä—Å–∏–Ω–≥ tool_use –æ—Ç–≤–µ—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ promptBuilder.js      # System prompts + prompt caching
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modelRouter.js        # Haiku (70%) / Sonnet (30%) –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ toolDefinitions.js    # ~10 Claude tool definitions
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mcp/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mcpManager.js         # –ú–µ–Ω–µ–¥–∂–µ—Ä MCP-—Å–µ—Ä–≤–µ—Ä–æ–≤ (–∑–∞–ø—É—Å–∫, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, lifecycle)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mcpRouter.js          # –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è tool_use –æ—Ç Claude –∫ MCP-—Å–µ—Ä–≤–µ—Ä–∞–º
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mcpConfig.js          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MCP-—Å–µ—Ä–≤–µ—Ä–æ–≤ (Google Calendar, Gmail, Drive)
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ integrations/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ yandexSpeech.js       # STT (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ç–µ–∫—É—â–µ–≥–æ)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ yandexTTS.js          # TTS - –≥–æ–ª–æ—Å–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ platforms/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot.js            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (webhook/polling)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ messageHandler.js   # –¢–µ–∫—Å—Ç
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voiceHandler.js     # –ì–æ–ª–æ—Å
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ photoHandler.js     # –§–æ—Ç–æ (Vision)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commandHandler.js   # /start, /help, /settings...
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ callbackHandler.js  # Inline keyboard callbacks
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ keyboards.js      # Inline keyboard builders
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ formatters.js     # Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ restAdapter.js    # REST API –∞–¥–∞–ø—Ç–µ—Ä (–¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ/PWA/–≤–µ–±)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ wsAdapter.js      # WebSocket –∞–¥–∞–ø—Ç–µ—Ä (real-time —á–∞—Ç)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ web/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ webAdapter.js     # –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–±—É–¥—É—â–µ–µ)
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sessionManager.js     # DB-backed —Å–µ—Å—Å–∏–∏ (–∑–∞–º–µ–Ω–∞ chatHistories)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ messageProcessor.js   # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ actionExecutor.js     # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ parsed intents
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ digestService.js      # –£—Ç—Ä–µ–Ω–Ω–∏–π –¥–∞–π–¥–∂–µ—Å—Ç (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ notificationService.js # –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ billing/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ subscriptionService.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ creditService.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stripeService.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tierLimits.js         # –õ–∏–º–∏—Ç—ã –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ crm/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ contactService.js
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ interactionService.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dateUtils.js              # –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: timezone –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ crypto.js                 # bcrypt helpers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators.js             # Zod —Å—Ö–µ–º—ã –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ errors.js                 # AppError, ValidationError, AuthenticationError...
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ app.js                        # Express: middleware chain + routes
‚îÇ   ‚îî‚îÄ‚îÄ server.js                     # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ + graceful shutdown
‚îÇ
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ unit/                         # –Æ–Ω–∏—Ç —Ç–µ—Å—Ç—ã (vitest)
‚îÇ   ‚îú‚îÄ‚îÄ integration/                  # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (supertest)
‚îÇ   ‚îú‚îÄ‚îÄ fixtures/                     # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îî‚îÄ‚îÄ setup.js                      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .gitignore                        # –ü–æ–ª–Ω—ã–π (node_modules, .env, logs, ffmpeg, coverage...)
‚îú‚îÄ‚îÄ .eslintrc.json
‚îú‚îÄ‚îÄ .prettierrc
‚îú‚îÄ‚îÄ .sequelizerc
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

### –ü–æ—è—Å–Ω–µ–Ω–∏—è –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

| –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è / —Ñ–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|
| `.github/workflows/` | CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ã. `ci.yml` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—ã–π PR (lint + —Ç–µ—Å—Ç—ã + —Å–±–æ—Ä–∫–∞). `deploy.yml` -- –¥–µ–ø–ª–æ–π –ø—Ä–∏ –º–µ—Ä–∂–µ –≤ `main`. |
| `docker/` | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è. Production-–æ–±—Ä–∞–∑ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è multi-stage (builder -> runner). Dev-–æ–±—Ä–∞–∑ –≤–∫–ª—é—á–∞–µ—Ç nodemon –∏ volume-–º–∞—É–Ω—Ç –¥–ª—è hot reload. |
| `src/config/` | –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. `index.js` —Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏—Ö —á–µ—Ä–µ–∑ zod-—Å—Ö–µ–º—É. –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç -- –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è. |
| `src/models/` | Sequelize –º–æ–¥–µ–ª–∏. `index.js` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª–∏ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `associate()` —É –∫–∞–∂–¥–æ–π. |
| `src/migrations/` | –ú–∏–≥—Ä–∞—Ü–∏–∏ Sequelize CLI. –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª -- –æ–¥–Ω–∞ –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞, –∏–Ω–¥–µ–∫—Å). –û—Ç–∫–∞—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –≤ –∫–∞–∂–¥–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏. |
| `src/middleware/` | Express middleware, –ø–æ–¥–∫–ª—é—á–∞–µ–º—ã–π –≤ `app.js`. –ü–æ—Ä—è–¥–æ–∫: `requestLogger` -> `rateLimiter` -> `auth` (–Ω–∞ –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–∞—Ö) -> `validator` -> –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä -> `errorHandler`. |
| `src/routes/` | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤. –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `express.Router()`. `index.js` —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Ä–æ—É—Ç–µ—Ä—ã –∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç –∏—Ö –ø–æ–¥ `/api/v1/`. |
| `src/controllers/` | –¢–æ–Ω–∫–∏–π —Å–ª–æ–π: –ø—Ä–∏–Ω–∏–º–∞—é—Ç –∑–∞–ø—Ä–æ—Å, –≤—ã–∑—ã–≤–∞—é—Ç —Å–µ—Ä–≤–∏—Å, —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç –æ—Ç–≤–µ—Ç. –ù–∏–∫–∞–∫–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ -- —Ç–æ–ª—å–∫–æ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è. |
| `src/services/ai/` | –†–∞–±–æ—Ç–∞ —Å Claude API. `modelRouter.js` —Ä–µ—à–∞–µ—Ç, –∫–∞–∫—É—é –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (Haiku –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, Sonnet –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö). `promptBuilder.js` —Å–æ–±–∏—Ä–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º. |
| `src/services/mcp/` | **MCP Layer** -- —è–¥—Ä–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π —Å Google. `mcpManager.js` –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º MCP-—Å–µ—Ä–≤–µ—Ä–æ–≤. `mcpRouter.js` –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç tool_use –≤—ã–∑–æ–≤—ã –æ—Ç Claude –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º MCP-—Å–µ—Ä–≤–µ—Ä–∞–º. `mcpConfig.js` -- –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤ (credentials, scopes). |
| `src/services/integrations/` | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ MCP (Yandex SpeechKit STT/TTS). –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª -- –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç. |
| `src/services/platforms/` | –ê–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º –¥–æ—Å—Ç–∞–≤–∫–∏ (Telegram, REST API, WebSocket, Web). –ö–∞–∂–¥—ã–π –∞–¥–∞–ø—Ç–µ—Ä –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç `UnifiedMessage` –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –≤ `messageProcessor.js`. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å** -- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (Slack, WhatsApp, Viber) —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤–æ–≥–æ –∞–¥–∞–ø—Ç–µ—Ä–∞. |
| `src/services/core/` | –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã. `messageProcessor.js` -- –≥–ª–∞–≤–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π. `actionExecutor.js` -- –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π (—Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è, –∑–∞–¥–∞—á–∏ –∏ —Ç.–¥.). |
| `src/services/billing/` | –ü–æ–¥–ø–∏—Å–∫–∏, –∫—Ä–µ–¥–∏—Ç—ã, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ Stripe. `tierLimits.js` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ª–∏–º–∏—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞. |
| `src/services/crm/` | CRM-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –∏ –∏—Å—Ç–æ—Ä–∏–µ–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π. |
| `src/utils/` | –£—Ç–∏–ª–∏—Ç—ã –æ–±—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è. `errors.js` —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ —Å HTTP-–∫–æ–¥–∞–º–∏. `validators.js` -- zod-—Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. |
| `tests/` | –¢–µ—Å—Ç—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ —é–Ω–∏—Ç (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, —Å –º–æ–∫–∞–º–∏) –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ (—Ä–µ–∞–ª—å–Ω–∞—è –ë–î, supertest). |

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω: Platform -> Core -> Services

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Secretary Bot –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ —Ç—Ä—ë—Ö—Å–ª–æ–π–Ω–æ–π –º–æ–¥–µ–ª–∏, –≥–¥–µ –∫–∞–∂–¥—ã–π —Å–ª–æ–π –∏–º–µ–µ—Ç
—á—ë—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é –∑–æ–Ω—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏. –ó–∞–ø—Ä–æ—Å –≤—Å–µ–≥–¥–∞ –¥–≤–∏–∂–µ—Ç—Å—è —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑:
–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç, —è–¥—Ä–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, —Å–µ—Ä–≤–∏—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                       PLATFORM LAYER                             ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   Telegram    ‚îÇ ‚îÇ REST API ‚îÇ ‚îÇ WebSocket ‚îÇ ‚îÇ   Web App     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ     Bot       ‚îÇ ‚îÇ   (v1)   ‚îÇ ‚îÇ (real-time‚îÇ ‚îÇ   (PWA)       ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ         ‚îÇ              ‚îÇ             ‚îÇ               ‚îÇ           ‚îÇ
‚îÇ         ‚îÇ    –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (UnifiedMessage)  ‚îÇ           ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ                        ‚îÇ             ‚îÇ                           ‚îÇ
‚îÇ  –ö–∞–∂–¥—ã–π –∞–¥–∞–ø—Ç–µ—Ä –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ                  ‚îÇ
‚îÇ  –≤ –µ–¥–∏–Ω—ã–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç:                                     ‚îÇ
‚îÇ  { userId, text, type, platform, attachments, metadata }         ‚îÇ
‚îÇ                        ‚îÇ                                         ‚îÇ
‚îÇ                        ‚ñº                                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                       CORE LAYER                                 ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ                 messageProcessor.js                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   1. –ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é (Session)                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (billing)               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (Message)                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   4. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑ –ë–î (–ø–æ—Å–ª–µ–¥–Ω–∏–µ N)                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ AI Handler (Claude API)                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   6. –ü–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç (text / tool_use)                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   7. –ï—Å–ª–∏ tool_use ‚Üí –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ MCP Router     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   8. –í–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç tool –≤ Claude ‚Üí –ø–æ–ª—É—á–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   9. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç –±–æ—Ç–∞ (Message)                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  10. –°–ø–∏—Å–∞—Ç—å –∫—Ä–µ–¥–∏—Ç—ã (CreditTransaction)                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  11. –í–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ                           ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ              ‚îÇ                 ‚îÇ                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ  ‚îÇ  sessionManager.js ‚îÇ  ‚îÇ  actionExecutor.js    ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ                    ‚îÇ  ‚îÇ                       ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  - getOrCreate()   ‚îÇ  ‚îÇ  –î–µ–ª–µ–≥–∏—Ä—É–µ—Ç tool_use  ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  - addMessage()    ‚îÇ  ‚îÇ  –∫ MCP-—Å–µ—Ä–≤–µ—Ä–∞–º –∏–ª–∏   ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  - getHistory()    ‚îÇ  ‚îÇ  –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º: ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  - summarize()     ‚îÇ  ‚îÇ  - createNote()       ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  - cleanup()       ‚îÇ  ‚îÇ  - createTask()       ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ                    ‚îÇ  ‚îÇ  - lookupContact()    ‚îÇ               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                       SERVICE LAYER                              ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   AI Service   ‚îÇ ‚îÇ         MCP LAYER (Google —Å–µ—Ä–≤–∏—Å—ã)      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                ‚îÇ ‚îÇ                                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ claudeHandler  ‚îÇ ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ intentParser   ‚îÇ ‚îÇ  ‚îÇ MCP Manager ‚îÇ ‚îÇ   MCP Router     ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ promptBuilder  ‚îÇ ‚îÇ  ‚îÇ (lifecycle) ‚îÇ ‚îÇ (tool_use ‚Üí MCP) ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ modelRouter    ‚îÇ ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ toolDefinitions‚îÇ ‚îÇ         ‚îÇ                  ‚îÇ            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                ‚îÇ ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ  ‚îÇ         MCP Servers               ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ                     ‚îÇ  ‚îÇ                                   ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ  ‚îÇ üìÖ Google Calendar MCP Server    ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Integrations  ‚îÇ ‚îÇ  ‚îÇ üìß Gmail MCP Server              ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  (non-MCP)     ‚îÇ ‚îÇ  ‚îÇ üìÅ Google Drive/Docs MCP Server  ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                ‚îÇ ‚îÇ  ‚îÇ üìù (Notion MCP Server - –±—É–¥—É—â–µ–µ)  ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ yandexSpeech   ‚îÇ ‚îÇ  ‚îÇ üí¨ (Slack MCP Server - –±—É–¥—É—â–µ–µ)   ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ yandexTTS      ‚îÇ ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
‚îÇ  ‚îÇ  CRM Service   ‚îÇ ‚îÇ  Digest &     ‚îÇ ‚îÇ  Billing  ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ                ‚îÇ ‚îÇ  Notifications‚îÇ ‚îÇ  Service  ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ contactService ‚îÇ ‚îÇ               ‚îÇ ‚îÇ           ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ interactionSvc ‚îÇ ‚îÇ digestService ‚îÇ ‚îÇ subscrip- ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ                ‚îÇ ‚îÇ notification  ‚îÇ ‚îÇ tionSvc   ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ                ‚îÇ ‚îÇ Service       ‚îÇ ‚îÇ creditSvc ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ                ‚îÇ ‚îÇ               ‚îÇ ‚îÇ stripeSvc ‚îÇ             ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                       DATA LAYER                                 ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ  ‚îÇ    PostgreSQL      ‚îÇ  ‚îÇ        Redis           ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ    (Sequelize)     ‚îÇ  ‚îÇ       (cache)          ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ                    ‚îÇ  ‚îÇ                        ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  14 —Ç–∞–±–ª–∏—Ü        ‚îÇ  ‚îÇ  - –ö—ç—à —Å–µ—Å—Å–∏–π          ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  –ú–∏–≥—Ä–∞—Ü–∏–∏          ‚îÇ  ‚îÇ  - Rate limit counters ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  –ò–Ω–¥–µ–∫—Å—ã           ‚îÇ  ‚îÇ  - –ö—ç—à –ø—Ä–æ–º–ø—Ç–æ–≤        ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  JSONB –ø–æ–ª—è        ‚îÇ  ‚îÇ  - Pub/Sub (—É–≤–µ–¥–æ–º–ª.)  ‚îÇ               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **Platform-–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–æ—Å—Ç—å.** Core Layer –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–µ—Ç –æ Telegram, REST –∏–ª–∏ WebSocket.
   –û–Ω –æ–ø–µ—Ä–∏—Ä—É–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–º–∏ –ø–æ–Ω—è—Ç–∏—è–º–∏: "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", "—Å–æ–æ–±—â–µ–Ω–∏–µ", "—Å–µ—Å—Å–∏—è".
   –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (Slack, WhatsApp, Viber) –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —è–¥—Ä–∞.

2. **–ï–¥–∏–Ω—ã–π pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏.** –õ—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -- —Ç–µ–∫—Å—Ç –∏–∑ Telegram, –≥–æ–ª–æ—Å–æ–≤–æ–µ,
   —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –∏–ª–∏ –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ REST API -- –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ
   `messageProcessor.js`. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö.

3. **AI –∫–∞–∫ —Å–µ—Ä–≤–∏—Å.** Claude API –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ `services/ai/`. –Ø–¥—Ä–æ –Ω–µ –∑–Ω–∞–µ—Ç
   –¥–µ—Ç–∞–ª–µ–π –ø—Ä–æ–º–ø—Ç–æ–≤, –º–æ–¥–µ–ª–µ–π –∏–ª–∏ tool definitions. –ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–º–µ–Ω–∏—Ç—å Claude
   –Ω–∞ –¥—Ä—É–≥—É—é LLM -- –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç —Ç–æ–ª—å–∫–æ –≤ `services/ai/`.

4. **Google —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ MCP.** –í–º–µ—Å—Ç–æ —Ä—É—á–Ω—ã—Ö –æ–±—ë—Ä—Ç–æ–∫ –Ω–∞–¥ Google API –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
   MCP-—Å–µ—Ä–≤–µ—Ä—ã Claude. Claude —Å–∞–º –≤—ã–∑—ã–≤–∞–µ—Ç tool_use –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Calendar, Gmail,
   Drive. –ë—ç–∫–µ–Ω–¥ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç —ç—Ç–∏ –≤—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ `mcpRouter.js` –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º
   MCP-—Å–µ—Ä–≤–µ—Ä–∞–º. –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥, —Å–Ω–∏–∂–∞–µ—Ç maintenance burden –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç
   –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π. –ù–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã (Notion, Slack) –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫–∞–∫
   –Ω–æ–≤—ã–µ MCP-—Å–µ—Ä–≤–µ—Ä—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —è–¥—Ä–∞.

5. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤.** –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É
   –æ–±–ª–∞—Å—Ç—å: AI, MCP-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –±–∏–ª–ª–∏–Ω–≥, CRM. –°–µ—Ä–≤–∏—Å—ã –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞
   –Ω–∞–ø—Ä—è–º—É—é -- –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é –≤—ã–ø–æ–ª–Ω—è–µ—Ç Core Layer.

6. **–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å.** –í—Å–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (Telegram, REST, WebSocket, Web)
   –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–π `UnifiedMessage` —Ñ–æ—Ä–º–∞—Ç. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã --
   —ç—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∞–¥–∞–ø—Ç–µ—Ä–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏. REST API
   –¥–æ—Å—Ç—É–ø–µ–Ω —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è –¥–ª—è –±—É–¥—É—â–∏—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö –∏ –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–æ–≤.

5. **DB-backed —Å–µ—Å—Å–∏–∏.** –í–º–µ—Å—Ç–æ in-memory `chatHistories` (—Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
   –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –≤ PostgreSQL. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å,
   –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É.

6. **Graceful degradation.** –ï—Å–ª–∏ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (Google API, Yandex),
   –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å -- –ø—Ä–æ—Å—Ç–æ —Å–æ–æ–±—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —á—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è
   —Ñ—É–Ω–∫—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö: –ø—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (—Å MCP)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ –≤ Telegram
2. telegram/handlers/voiceHandler.js:
   - –°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ yandexSpeech.js -> –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—Å—Ç
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç UnifiedMessage { userId, text, type: 'voice', platform: 'telegram', ... }
   - –ü–µ—Ä–µ–¥–∞—ë—Ç –≤ messageProcessor.js
3. messageProcessor.js:
   - getOrCreate(session) –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã (tierLimits.js)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç Message (type: 'voice', message_text: —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç)
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –ë–î
   - –í—ã–∑—ã–≤–∞–µ—Ç claudeHandler.js —Å –∏—Å—Ç–æ—Ä–∏–µ–π
4. claudeHandler.js:
   - modelRouter.js –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–æ–¥–µ–ª—å (Haiku/Sonnet)
   - promptBuilder.js —Å–æ–±–∏—Ä–∞–µ—Ç system prompt (—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
   - toolDefinitions.js –≤–∫–ª—é—á–∞–µ—Ç MCP-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (calendar, gmail, drive)
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ Claude API
   - –ü–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç: tool_use "create_calendar_event"
5. mcpRouter.js –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç tool_use:
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç: "create_calendar_event" ‚Üí Google Calendar MCP Server
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–∑–æ–≤ –≤ MCP-—Å–µ—Ä–≤–µ—Ä
   - MCP-—Å–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞—ë—Ç —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ Google Calendar API
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç (ID —Å–æ–±—ã—Ç–∏—è, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)
6. messageProcessor.js:
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç tool_result –æ–±—Ä–∞—Ç–Ω–æ –≤ Claude API
   - Claude —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç–≤–µ—Ç –±–æ—Ç–∞ (Message)
   - –°–ø–∏—Å—ã–≤–∞–µ—Ç –∫—Ä–µ–¥–∏—Ç—ã (CreditTransaction)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
7. voiceHandler.js:
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –≤ Telegram
   - (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) yandexTTS.js -> –≥–æ–ª–æ—Å–æ–≤–æ–π –æ—Ç–≤–µ—Ç
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö: —Ç–æ—Ç –∂–µ –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ REST API (–º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)

```
1. –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /api/v1/chat
   { "message": "–°–æ–∑–¥–∞–π –≤—Å—Ç—Ä–µ—á—É —Å –ò–≤–∞–Ω–æ–º –∑–∞–≤—Ç—Ä–∞ –≤ 10:00", "session_id": 42 }
2. restAdapter.js:
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç userId –∏–∑ JWT
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç UnifiedMessage { userId, text, type: 'text', platform: 'api', ... }
   - –ü–µ—Ä–µ–¥–∞—ë—Ç –≤ messageProcessor.js
3-6. [–ò–¥–µ–Ω—Ç–∏—á–Ω—ã–π flow —á–µ—Ä–µ–∑ Core ‚Üí AI ‚Üí MCP ‚Üí Claude]
7. restAdapter.js:
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON-–æ—Ç–≤–µ—Ç: { "success": true, "data": { "reply": "..." } }
```

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç**: —à–∞–≥–∏ 3-6 –∞–±—Å–æ–ª—é—Ç–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã –¥–ª—è –õ–Æ–ë–û–ô –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. –ú–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–¥–∞–ø—Ç–µ—Ä –Ω–∞ –≤—Ö–æ–¥–µ –∏ –≤—ã—Ö–æ–¥–µ.

---

## –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ API endpoints (REST API v1)

–í—Å–µ endpoints –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É `/api/v1/`. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –∏–Ω–æ–µ, —Ç—Ä–µ–±—É–µ—Ç—Å—è
JWT-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>`.

### Auth -- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (4 endpoints)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `POST` | `/api/v1/auth/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `username`, `password`, `email` (–æ–ø—Ü.), `timezone` (–æ–ø—Ü.). –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `access_token` + `refresh_token`. | –ù–µ—Ç |
| `POST` | `/api/v1/auth/login` | –í—Ö–æ–¥ –ø–æ `username` + `password`. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `access_token` + `refresh_token`. | –ù–µ—Ç |
| `POST` | `/api/v1/auth/refresh` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access token –ø–æ `refresh_token`. | –ù–µ—Ç |
| `POST` | `/api/v1/auth/telegram` | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram Login Widget. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç Telegram, —Å–æ–∑–¥–∞—ë—Ç/–Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. | –ù–µ—Ç |

### Users -- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (3 endpoints)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/api/v1/users/me` | –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–∫–ª—é—á–∞—è –ø–æ–¥–ø–∏—Å–∫—É, –∫—Ä–µ–¥–∏—Ç—ã, –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏). | JWT |
| `PUT` | `/api/v1/users/me` | –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å (`email`, `timezone`, `language`). | JWT |
| `PUT` | `/api/v1/users/me/settings` | –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ (—Ñ–æ—Ä–º–∞—Ç –¥–∞–π–¥–∂–µ—Å—Ç–∞, –≤—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –≥–æ–ª–æ—Å–∞). | JWT |

### Chat -- –ß–∞—Ç –∏ —Å–µ—Å—Å–∏–∏ (4 endpoints)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `POST` | `/api/v1/chat` | –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É —á–µ—Ä–µ–∑ REST API (–¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ/PWA). –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `message`, `session_id` (–æ–ø—Ü.). –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –±–æ—Ç–∞. | JWT |
| `GET` | `/api/v1/chat/sessions` | –°–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–∞–≥–∏–Ω–∞—Ü–∏—è: `?page=1&limit=20`. | JWT |
| `GET` | `/api/v1/chat/sessions/:id` | –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Å—Å–∏—é —Å –∏—Å—Ç–æ—Ä–∏–µ–π —Å–æ–æ–±—â–µ–Ω–∏–π. –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π: `?page=1&limit=50`. | JWT |
| `DELETE` | `/api/v1/chat/sessions/:id` | –£–¥–∞–ª–∏—Ç—å (–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å) —Å–µ—Å—Å–∏—é. Soft delete -- —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `ended_at`. | JWT |

### Events -- –°–æ–±—ã—Ç–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è (7 endpoints)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/api/v1/events` | –°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π. –§–∏–ª—å—Ç—Ä—ã: `?from=2026-02-01&to=2026-02-28`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é -- —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü. | JWT |
| `POST` | `/api/v1/events` | –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ: `title`, `event_date`, `end_date`. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: `description`, `recurrence_rule`, `reminder_minutes`. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Google Calendar –µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á—ë–Ω. | JWT |
| `GET` | `/api/v1/events/:id` | –ü–æ–ª—É—á–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –ø–æ ID. | JWT |
| `PUT` | `/api/v1/events/:id` | –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Google Calendar. | JWT |
| `DELETE` | `/api/v1/events/:id` | –£–¥–∞–ª–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ. –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ Google Calendar. | JWT |
| `GET` | `/api/v1/events/today` | –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø: —Å–æ–±—ã—Ç–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è. –£—á–∏—Ç—ã–≤–∞–µ—Ç timezone –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. | JWT |
| `GET` | `/api/v1/events/range` | –°–æ–±—ã—Ç–∏—è –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥: `?start=2026-02-10&end=2026-02-14`. | JWT |

### Tasks -- –ó–∞–¥–∞—á–∏ (6 endpoints)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/api/v1/tasks` | –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á. –§–∏–ª—å—Ç—Ä—ã: `?status=pending&priority=high&assigned_to=5`. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: `?sort=due_date&order=asc`. | JWT |
| `POST` | `/api/v1/tasks` | –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ: `title`. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: `description`, `priority`, `due_date`, `tags`, `assigned_employee_id`. | JWT |
| `GET` | `/api/v1/tasks/:id` | –ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á—É –ø–æ ID. | JWT |
| `PUT` | `/api/v1/tasks/:id` | –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É (–ª—é–±—ã–µ –ø–æ–ª—è). | JWT |
| `PUT` | `/api/v1/tasks/:id/status` | –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏: `{ "status": "done" }`. –û—Ç–¥–µ–ª—å–Ω—ã–π endpoint –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞. –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: `pending`, `in_progress`, `done`, `cancelled`. | JWT |
| `DELETE` | `/api/v1/tasks/:id` | –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É. | JWT |

### Notes -- –ó–∞–º–µ—Ç–∫–∏ (6 endpoints)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/api/v1/notes` | –°–ø–∏—Å–æ–∫ –∑–∞–º–µ—Ç–æ–∫. –§–∏–ª—å—Ç—Ä—ã: `?category=meeting&completed=false`. | JWT |
| `POST` | `/api/v1/notes` | –°–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ: `content`. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: `category`. | JWT |
| `GET` | `/api/v1/notes/:id` | –ü–æ–ª—É—á–∏—Ç—å –∑–∞–º–µ—Ç–∫—É –ø–æ ID. | JWT |
| `PUT` | `/api/v1/notes/:id` | –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É. | JWT |
| `PUT` | `/api/v1/notes/:id/complete` | –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–º–µ—Ç–∫—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é: `{ "completed": true }`. | JWT |
| `DELETE` | `/api/v1/notes/:id` | –£–¥–∞–ª–∏—Ç—å –∑–∞–º–µ—Ç–∫—É. | JWT |

### Contacts CRM -- –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (7 endpoints)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/api/v1/contacts` | –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤. –§–∏–ª—å—Ç—Ä—ã: `?search=–ò–≤–∞–Ω&company=Acme&tags=vip`. | JWT |
| `POST` | `/api/v1/contacts` | –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ: `name`. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: `email`, `phone`, `company`, `position`, `telegram_handle`, `notes`, `tags`. | JWT |
| `GET` | `/api/v1/contacts/:id` | –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç –ø–æ ID (–≤–∫–ª—é—á–∞—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π). | JWT |
| `PUT` | `/api/v1/contacts/:id` | –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç. | JWT |
| `DELETE` | `/api/v1/contacts/:id` | –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç (–∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π). | JWT |
| `POST` | `/api/v1/contacts/:id/interactions` | –î–æ–±–∞–≤–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º: `{ "type": "call", "summary": "–û–±—Å—É–¥–∏–ª–∏...", "scheduled_follow_up": "2026-02-20" }`. | JWT |
| `GET` | `/api/v1/follow-ups` | –í—Å–µ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ follow-up –ø–æ –≤—Å–µ–º –∫–æ–Ω—Ç–∞–∫—Ç–∞–º. –§–∏–ª—å—Ç—Ä: `?from=2026-02-12&to=2026-02-19`. | JWT |

### Billing -- –ë–∏–ª–ª–∏–Ω–≥ –∏ –ø–æ–¥–ø–∏—Å–∫–∏ (6 endpoints)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/api/v1/billing/subscription` | –¢–µ–∫—É—â–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–∞—Ä–∏—Ñ, —Å—Ç–∞—Ç—É—Å, –¥–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞). | JWT |
| `POST` | `/api/v1/billing/checkout` | –°–æ–∑–¥–∞—Ç—å Stripe Checkout Session –¥–ª—è –æ–ø–ª–∞—Ç—ã: `{ "tier": "professional" }`. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `checkout_url`. | JWT |
| `POST` | `/api/v1/billing/cancel` | –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –≤ –∫–æ–Ω—Ü–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞. | JWT |
| `GET` | `/api/v1/billing/usage` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ –¥–µ–Ω—å/–º–µ—Å—è—Ü, —Ç–æ–∫–µ–Ω—ã, —Å—Ç–æ–∏–º–æ—Å—Ç—å. | JWT |
| `GET` | `/api/v1/billing/credits` | –ë–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤ –∏ –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: `?page=1&limit=20`. | JWT |
| `POST` | `/api/v1/billing/webhook/stripe` | Stripe webhook. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è: `checkout.session.completed`, `invoice.paid`, `invoice.payment_failed`, `customer.subscription.updated`, `customer.subscription.deleted`. | –ù–µ—Ç (Stripe signature) |

### Digest -- –î–∞–π–¥–∂–µ—Å—Ç (1 endpoint)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/api/v1/digest` | –ü–æ–ª—É—á–∏—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è: —Å–æ–±—ã—Ç–∏—è, –∑–∞–¥–∞—á–∏, follow-up, –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –ø–∏—Å—å–º–∞ (–µ—Å–ª–∏ Gmail –ø–æ–¥–∫–ª—é—á—ë–Ω). | JWT |

### Health -- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è (2 endpoints)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/api/v1/health` | Liveness probe. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ "status": "ok", "uptime": 12345 }`. | –ù–µ—Ç |
| `GET` | `/api/v1/health/ready` | Readiness probe. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å PostgreSQL –∏ Redis. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ "status": "ready", "postgres": "ok", "redis": "ok" }`. | –ù–µ—Ç |

### Integrations -- OAuth –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (2 endpoints)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
|---|---|---|---|
| `GET` | `/api/v1/integrations/google/auth` | –ù–∞—á–∞—Ç—å OAuth flow —Å Google. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ Google consent screen. Scopes: `calendar`, `gmail.readonly`, `gmail.send`, `docs`. | JWT |
| `GET` | `/api/v1/integrations/google/callback` | OAuth callback –æ—Ç Google. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –≤ OAuthToken. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. | –ù–µ—Ç (state param) |

### –°–≤–æ–¥–∫–∞ endpoints

| –ì—Ä—É–ø–ø–∞ | –ö–æ–ª-–≤–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| Auth | 4 | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≤—Ö–æ–¥, refresh, Telegram |
| Users | 3 | –ü—Ä–æ—Ñ–∏–ª—å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| Chat | 4 | –°–æ–æ–±—â–µ–Ω–∏—è –∏ —Å–µ—Å—Å–∏–∏ |
| Events | 7 | –ö–∞–ª–µ–Ω–¥–∞—Ä—å |
| Tasks | 6 | –ó–∞–¥–∞—á–∏ |
| Notes | 6 | –ó–∞–º–µ—Ç–∫–∏ |
| Contacts CRM | 7 | –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è |
| Billing | 6 | –ü–æ–¥–ø–∏—Å–∫–∏ –∏ –ø–ª–∞—Ç–µ–∂–∏ |
| Digest | 1 | –î–∞–π–¥–∂–µ—Å—Ç |
| Health | 2 | –ü—Ä–æ–≤–µ—Ä–∫–∏ |
| Integrations | 2 | OAuth |
| **–ò—Ç–æ–≥–æ** | **48** | |

---

## –í—Å–µ –º–æ–¥–µ–ª–∏ –ë–î (14 —à—Ç—É–∫)

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–æ –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ú–æ–¥–µ–ª–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞
–¥–≤–µ –≥—Ä—É–ø–ø—ã: —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ (—Ç—Ä–µ–±—É—é—â–∏–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞) –∏ –Ω–æ–≤—ã–µ.

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥) -- 8 —à—Ç—É–∫

#### 1. User

–û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø–æ–¥–ø–∏—Å–∫—É.

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|
| `id` | `INTEGER` | PK, auto-increment | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `username` | `STRING` | UNIQUE, NOT NULL | –õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `password_hash` | `STRING(255)` | NOT NULL | –•—ç—à –ø–∞—Ä–æ–ª—è (bcrypt) |
| `email` | `STRING` | UNIQUE, nullable | Email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| `telegram_id` | `STRING` | UNIQUE, nullable | Telegram user ID |
| `role` | `ENUM` | `admin`, `boss`, `employee` | –†–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ |
| `timezone` | `STRING` | default `'Asia/Dubai'` | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (IANA) |
| `language` | `STRING` | default `'ru'` | –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ |
| `subscription_tier` | `ENUM` | `free`, `professional`, `business`, `enterprise`; default `'free'` | –¢–µ–∫—É—â–∏–π —Ç–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω |
| `is_active` | `BOOLEAN` | default `true` | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –∞–∫–∫–∞—É–Ω—Ç |
| `created_at` | `DATE` | auto | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | `DATE` | auto | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:**
- `hasMany` -> Employee, Event, Task (—á–µ—Ä–µ–∑ created_by), Note, Session, Contact,
  Interaction, Subscription, Payment, CreditTransaction, OAuthToken

**–ò–Ω–¥–µ–∫—Å—ã:**
- `UNIQUE` –Ω–∞ `username`, `email`, `telegram_id`

---

#### 2. Employee

–°–æ—Ç—Ä—É–¥–Ω–∏–∫, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é-—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é. Legacy-–º–æ–¥–µ–ª—å, –≤ –±—É–¥—É—â–µ–º
—Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ª–∏—è–Ω–∏–µ —Å User (—Å–æ—Ç—Ä—É–¥–Ω–∏–∫ = User —Å role=employee).

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|
| `id` | `INTEGER` | PK, auto-increment | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `user_id` | `INTEGER` | FK -> users, NOT NULL | –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å |
| `full_name` | `STRING(100)` | NOT NULL | –ü–æ–ª–Ω–æ–µ –∏–º—è |
| `telegram_id` | `STRING(50)` | nullable | Telegram user ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ |
| `email` | `STRING(100)` | nullable | Email —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ |
| `phone` | `STRING(50)` | nullable | –¢–µ–ª–µ—Ñ–æ–Ω |
| `position` | `STRING` | nullable | –î–æ–ª–∂–Ω–æ—Å—Ç—å |
| `department` | `STRING` | nullable | –û—Ç–¥–µ–ª |
| `created_at` | `DATE` | auto | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | `DATE` | auto | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:**
- `belongsTo` -> User (—á–µ—Ä–µ–∑ user_id)
- `hasMany` -> Task (—á–µ—Ä–µ–∑ assigned_employee_id)

---

#### 3. Event

–°–æ–±—ã—Ç–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å Google Calendar –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ OAuth-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|
| `id` | `INTEGER` | PK, auto-increment | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `user_id` | `INTEGER` | FK -> users, NOT NULL | –í–ª–∞–¥–µ–ª–µ—Ü —Å–æ–±—ã—Ç–∏—è |
| `title` | `STRING` | NOT NULL | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è |
| `description` | `TEXT` | nullable | –û–ø–∏—Å–∞–Ω–∏–µ |
| `event_date` | `DATE` | NOT NULL | –î–∞—Ç–∞/–≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ |
| `end_date` | `DATE` | NOT NULL | –î–∞—Ç–∞/–≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è |
| `google_calendar_event_id` | `STRING` | nullable | ID —Å–æ–±—ã—Ç–∏—è –≤ Google Calendar |
| `recurrence_rule` | `STRING` | nullable | –ü—Ä–∞–≤–∏–ª–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è (RFC 5545 RRULE) |
| `reminder_minutes` | `INTEGER` | default `15` | –ó–∞ —Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –Ω–∞–ø–æ–º–Ω–∏—Ç—å |
| `created_at` | `DATE` | auto | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | `DATE` | auto | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:**
- `belongsTo` -> User (—á–µ—Ä–µ–∑ user_id)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `user_id` + `event_date` (—Å–æ—Å—Ç–∞–≤–Ω–æ–π, –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –≤—ã–±–æ—Ä–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ –ø–µ—Ä–∏–æ–¥)

---

#### 4. Task

–ó–∞–¥–∞—á–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º, —Å—Ç–∞—Ç—É—Å–æ–º –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|
| `id` | `INTEGER` | PK, auto-increment | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `title` | `STRING(255)` | NOT NULL | –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ |
| `description` | `TEXT` | nullable | –û–ø–∏—Å–∞–Ω–∏–µ |
| `status` | `ENUM` | `pending`, `in_progress`, `done`, `cancelled`; default `'pending'` | –°—Ç–∞—Ç—É—Å |
| `priority` | `ENUM` | `low`, `medium`, `high`, `urgent`; default `'medium'` | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
| `due_date` | `DATE` | nullable | –î–µ–¥–ª–∞–π–Ω |
| `tags` | `ARRAY(STRING)` | nullable | –¢–µ–≥–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ |
| `reminder_at` | `DATE` | nullable | –ö–æ–≥–¥–∞ –Ω–∞–ø–æ–º–Ω–∏—Ç—å |
| `assigned_employee_id` | `INTEGER` | FK -> employees, nullable | –ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ |
| `created_by` | `INTEGER` | FK -> users, nullable | –°–æ–∑–¥–∞—Ç–µ–ª—å –∑–∞–¥–∞—á–∏ |
| `created_at` | `DATE` | auto | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | `DATE` | auto | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:**
- `belongsTo` -> Employee (—á–µ—Ä–µ–∑ assigned_employee_id)
- `belongsTo` -> User (—á–µ—Ä–µ–∑ created_by)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `created_by` + `status` (–¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Å—Ç–∞—Ç—É—Å—É)
- `assigned_employee_id`
- `due_date` (–¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π)
- GIN-–∏–Ω–¥–µ–∫—Å –Ω–∞ `tags` (–¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–µ–≥–∞–º)

---

#### 5. Note

–ó–∞–º–µ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ú–æ–∂–µ—Ç –∏–º–µ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –±—ã—Ç—å –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è
(checklist-–ø–∞—Ç—Ç–µ—Ä–Ω).

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|
| `id` | `INTEGER` | PK, auto-increment | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `user_id` | `INTEGER` | FK -> users, NOT NULL | –í–ª–∞–¥–µ–ª–µ—Ü –∑–∞–º–µ—Ç–∫–∏ |
| `content` | `TEXT` | NOT NULL | –¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏ |
| `category` | `STRING` | nullable | –ö–∞—Ç–µ–≥–æ—Ä–∏—è (meeting, idea, personal –∏ —Ç.–¥.) |
| `completed` | `BOOLEAN` | default `false` | –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –ª–∏ |
| `created_at` | `DATE` | auto | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | `DATE` | auto | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:**
- `belongsTo` -> User (—á–µ—Ä–µ–∑ user_id)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `user_id` + `completed` (–¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫)

---

#### 6. Session

–°–µ—Å—Å–∏—è —á–∞—Ç–∞. –ü—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ. –•—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏
—Ç–µ–∫—É—â–µ–µ —Ä–µ–∑—é–º–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞.

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|
| `id` | `INTEGER` | PK, auto-increment | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `user_id` | `INTEGER` | FK -> users, NOT NULL | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| `platform` | `ENUM` | `telegram`, `web`, `mobile` | –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞, –æ—Ç–∫—É–¥–∞ –Ω–∞—á–∞—Ç–∞ —Å–µ—Å—Å–∏—è |
| `session_type` | `ENUM` | `work`, `personal`; default `'work'` | –¢–∏–ø —Å–µ—Å—Å–∏–∏ |
| `metadata` | `JSONB` | nullable | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (telegram chat_id, device info –∏ —Ç.–¥.) |
| `started_at` | `DATE` | default `NOW` | –ù–∞—á–∞–ª–æ —Å–µ—Å—Å–∏–∏ |
| `ended_at` | `DATE` | nullable | –ö–æ–Ω–µ—Ü —Å–µ—Å—Å–∏–∏ (null = –∞–∫—Ç–∏–≤–Ω–∞) |
| `current_summary` | `TEXT` | nullable | –¢–µ–∫—É—â–µ–µ —Ä–µ–∑—é–º–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ (–¥–ª—è prompt compression) |

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:**
- `belongsTo` -> User (—á–µ—Ä–µ–∑ user_id)
- `hasMany` -> Message, Summary

**–ò–Ω–¥–µ–∫—Å—ã:**
- `user_id` + `ended_at` (–¥–ª—è –ø–æ–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π)
- `platform`

---

#### 7. Message

–°–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ä–∞–º–∫–∞—Ö —Å–µ—Å—Å–∏–∏. –•—Ä–∞–Ω–∏—Ç —Ç–µ–∫—Å—Ç, —Ç–∏–ø, tool_calls –æ—Ç Claude, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
—Ç–æ–∫–µ–Ω–æ–≤ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å.

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|
| `id` | `INTEGER` | PK, auto-increment | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `session_id` | `INTEGER` | FK -> sessions, NOT NULL | –°–µ—Å—Å–∏—è |
| `sender` | `ENUM` | `user`, `bot`, `system` | –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å |
| `message_text` | `TEXT` | nullable | –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è |
| `message_type` | `ENUM` | `text`, `voice`, `photo`, `system`; default `'text'` | –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è |
| `tool_calls` | `JSONB` | nullable | –í—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ Claude (tool_use –±–ª–æ–∫–∏) |
| `token_count` | `INTEGER` | nullable | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ (input + output) |
| `model_used` | `STRING` | nullable | –ö–∞–∫–∞—è –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ (haiku/sonnet) |
| `created_at` | `DATE` | auto | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:**
- `belongsTo` -> Session (—á–µ—Ä–µ–∑ session_id)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `session_id` + `created_at` (–¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ)
- `model_used` (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π)

---

#### 8. Summary

–†–µ–∑—é–º–µ —Å–µ—Å—Å–∏–∏, —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –¥–ª—è —Å–∂–∞—Ç–∏—è –¥–ª–∏–Ω–Ω—ã—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤.

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|
| `id` | `INTEGER` | PK, auto-increment | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `session_id` | `INTEGER` | FK -> sessions, NOT NULL | –°–µ—Å—Å–∏—è |
| `summary_text` | `TEXT` | NOT NULL | –¢–µ–∫—Å—Ç —Ä–µ–∑—é–º–µ |
| `created_at` | `DATE` | auto | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:**
- `belongsTo` -> Session (—á–µ—Ä–µ–∑ session_id)

---

### –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ -- 6 —à—Ç—É–∫

#### 9. Contact

CRM-–∫–æ–Ω—Ç–∞–∫—Ç. –•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–µ–ª–æ–≤–µ–∫–µ, —Å –∫–æ—Ç–æ—Ä—ã–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|
| `id` | `INTEGER` | PK, auto-increment | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `user_id` | `INTEGER` | FK -> users, NOT NULL | –í–ª–∞–¥–µ–ª–µ—Ü –∫–æ–Ω—Ç–∞–∫—Ç–∞ |
| `name` | `STRING(200)` | NOT NULL | –ò–º—è –∫–æ–Ω—Ç–∞–∫—Ç–∞ |
| `email` | `STRING(100)` | nullable | Email |
| `phone` | `STRING(50)` | nullable | –¢–µ–ª–µ—Ñ–æ–Ω |
| `company` | `STRING(200)` | nullable | –ö–æ–º–ø–∞–Ω–∏—è |
| `position` | `STRING(200)` | nullable | –î–æ–ª–∂–Ω–æ—Å—Ç—å |
| `telegram_handle` | `STRING(100)` | nullable | Telegram username |
| `notes` | `TEXT` | nullable | –ó–∞–º–µ—Ç–∫–∏ –æ –∫–æ–Ω—Ç–∞–∫—Ç–µ |
| `tags` | `ARRAY(STRING)` | nullable | –¢–µ–≥–∏ (vip, partner, client...) |
| `last_interaction_at` | `DATE` | nullable | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è |
| `created_at` | `DATE` | auto | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | `DATE` | auto | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:**
- `belongsTo` -> User (—á–µ—Ä–µ–∑ user_id)
- `hasMany` -> Interaction

**–ò–Ω–¥–µ–∫—Å—ã:**
- `user_id` + `name` (–¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- GIN-–∏–Ω–¥–µ–∫—Å –Ω–∞ `tags`
- `last_interaction_at` (–¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)

---

#### 10. Interaction

–ó–∞–ø–∏—Å—å –æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º: –≤—Å—Ç—Ä–µ—á–∞, –∑–≤–æ–Ω–æ–∫, –ø–∏—Å—å–º–æ –∏ —Ç.–¥.

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|
| `id` | `INTEGER` | PK, auto-increment | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `contact_id` | `INTEGER` | FK -> contacts, NOT NULL | –ö–æ–Ω—Ç–∞–∫—Ç |
| `user_id` | `INTEGER` | FK -> users, NOT NULL | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| `type` | `ENUM` | `meeting`, `call`, `email`, `message`, `note` | –¢–∏–ø –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è |
| `summary` | `TEXT` | nullable | –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ |
| `scheduled_follow_up` | `DATE` | nullable | –î–∞—Ç–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ follow-up |
| `created_at` | `DATE` | auto | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:**
- `belongsTo` -> Contact (—á–µ—Ä–µ–∑ contact_id)
- `belongsTo` -> User (—á–µ—Ä–µ–∑ user_id)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `contact_id` + `created_at`
- `user_id` + `scheduled_follow_up` (–¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö follow-up)

---

#### 11. Subscription

–ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–¥–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|
| `id` | `INTEGER` | PK, auto-increment | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `user_id` | `INTEGER` | FK -> users, UNIQUE | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–æ–¥–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞) |
| `tier` | `ENUM` | `free`, `professional`, `business`, `enterprise` | –¢–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω |
| `status` | `ENUM` | `active`, `cancelled`, `past_due`, `trial` | –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ |
| `stripe_subscription_id` | `STRING` | nullable | ID –ø–æ–¥–ø–∏—Å–∫–∏ –≤ Stripe |
| `current_period_start` | `DATE` | NOT NULL | –ù–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ |
| `current_period_end` | `DATE` | NOT NULL | –ö–æ–Ω–µ—Ü —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ |
| `cancel_at_period_end` | `BOOLEAN` | default `false` | –û—Ç–º–µ–Ω–∏—Ç—å –≤ –∫–æ–Ω—Ü–µ –ø–µ—Ä–∏–æ–¥–∞ |
| `created_at` | `DATE` | auto | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | `DATE` | auto | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:**
- `belongsTo` -> User (—á–µ—Ä–µ–∑ user_id)
- `hasMany` -> Payment

**–ò–Ω–¥–µ–∫—Å—ã:**
- `UNIQUE` –Ω–∞ `user_id`
- `stripe_subscription_id`
- `status`

---

#### 12. Payment

–ó–∞–ø–∏—Å—å –æ –ø–ª–∞—Ç–µ–∂–µ. –ü—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∫ –ø–æ–¥–ø–∏—Å–∫–µ.

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|
| `id` | `INTEGER` | PK, auto-increment | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `user_id` | `INTEGER` | FK -> users, NOT NULL | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| `subscription_id` | `INTEGER` | FK -> subscriptions, nullable | –ü–æ–¥–ø–∏—Å–∫–∞ (–µ—Å–ª–∏ –ø–ª–∞—Ç—ë–∂ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É) |
| `amount` | `DECIMAL(10,2)` | NOT NULL | –°—É–º–º–∞ |
| `currency` | `STRING(3)` | default `'USD'` | –í–∞–ª—é—Ç–∞ (ISO 4217) |
| `status` | `ENUM` | `pending`, `succeeded`, `failed`, `refunded` | –°—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ |
| `provider` | `ENUM` | `stripe`, `yukassa` | –ü–ª–∞—Ç—ë–∂–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä |
| `provider_payment_id` | `STRING` | NOT NULL | ID –ø–ª–∞—Ç–µ–∂–∞ —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ |
| `created_at` | `DATE` | auto | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:**
- `belongsTo` -> User (—á–µ—Ä–µ–∑ user_id)
- `belongsTo` -> Subscription (—á–µ—Ä–µ–∑ subscription_id)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `user_id` + `created_at`
- `provider_payment_id` (–¥–ª—è webhook-–æ–±—Ä–∞–±–æ—Ç–∫–∏)
- `status`

---

#### 13. CreditTransaction

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∫—Ä–µ–¥–∏—Ç–æ–≤. –§–∏–∫—Å–∏—Ä—É–µ—Ç –∫–∞–∂–¥–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ/–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π
–ø–æ –º–æ–¥–µ–ª–∏ –∏ —Ç–æ–∫–µ–Ω–∞–º.

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|
| `id` | `INTEGER` | PK, auto-increment | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `user_id` | `INTEGER` | FK -> users, NOT NULL | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| `type` | `ENUM` | `usage`, `purchase`, `bonus`, `refund` | –¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| `amount` | `INTEGER` | NOT NULL | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è) |
| `balance_after` | `INTEGER` | NOT NULL | –ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| `description` | `STRING` | nullable | –û–ø–∏—Å–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ Sonnet") |
| `model_used` | `STRING` | nullable | –ú–æ–¥–µ–ª—å AI (haiku-3.5, sonnet-4) |
| `tokens_input` | `INTEGER` | nullable | –í—Ö–æ–¥–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã |
| `tokens_output` | `INTEGER` | nullable | –í—ã—Ö–æ–¥–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã |
| `created_at` | `DATE` | auto | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:**
- `belongsTo` -> User (—á–µ—Ä–µ–∑ user_id)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `user_id` + `created_at` (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
- `user_id` + `type` (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ —Ç–∏–ø–∞–º)
- `model_used` (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ –º–æ–¥–µ–ª—è–º)

---

#### 14. OAuthToken

–•—Ä–∞–Ω–µ–Ω–∏–µ OAuth-—Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤. –¢–æ–∫–µ–Ω—ã —à–∏—Ñ—Ä—É—é—Ç—Å—è AES-256.

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|---|
| `id` | `INTEGER` | PK, auto-increment | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `user_id` | `INTEGER` | FK -> users, NOT NULL | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| `provider` | `ENUM` | `google`, `yandex`, `notion`, `slack` | –ü—Ä–æ–≤–∞–π–¥–µ—Ä |
| `access_token` | `TEXT` | encrypted, NOT NULL | Access token (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω AES-256) |
| `refresh_token` | `TEXT` | encrypted, nullable | Refresh token (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω AES-256) |
| `expires_at` | `DATE` | NOT NULL | –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è access token |
| `scopes` | `ARRAY(STRING)` | nullable | –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ scopes |
| `created_at` | `DATE` | auto | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | `DATE` | auto | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:**
- `belongsTo` -> User (—á–µ—Ä–µ–∑ user_id)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `user_id` + `provider` (UNIQUE -- –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω –Ω–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- `expires_at` (–¥–ª—è cron-job –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤)

---

### –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏

```
                          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                          ‚îÇ      User       ‚îÇ
                          ‚îÇ  (—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è)  ‚îÇ
                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                   ‚îÇ
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ           ‚îÇ           ‚îÇ           ‚îÇ               ‚îÇ
           ‚ñº           ‚ñº           ‚ñº           ‚ñº               ‚ñº
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇEmployee ‚îÇ ‚îÇ  Event  ‚îÇ ‚îÇ  Note  ‚îÇ ‚îÇ Session ‚îÇ   ‚îÇ  Contact   ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ                                   ‚îÇ              ‚îÇ
           ‚ñº                                   ‚ñº              ‚ñº
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ  Task   ‚îÇ                        ‚îÇ Message ‚îÇ  ‚îÇ Interaction ‚îÇ
      ‚îÇ(assigned‚îÇ                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ _to)    ‚îÇ                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                        ‚îÇ Summary ‚îÇ
                                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ Subscription ‚îÇ  ‚îÇ Payment ‚îÇ  ‚îÇCreditTransaction ‚îÇ  ‚îÇ OAuthToken ‚îÇ
      ‚îÇ  (1:1 User)  ‚îÇ‚îÄ‚îÄ‚îÇ         ‚îÇ  ‚îÇ                  ‚îÇ  ‚îÇ            ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –§–æ—Ä–º–∞—Ç API –æ—Ç–≤–µ—Ç–æ–≤

–í—Å–µ API endpoints –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—Ç–≤–µ—Ç—ã –≤ –µ–¥–∏–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ. –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É
–Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å.

### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç

```json
{
  "success": true,
  "data": {
    "id": 1,
    "title": "–í—Å—Ç—Ä–µ—á–∞ —Å –ò–≤–∞–Ω–æ–º",
    "event_date": "2026-02-13T10:00:00.000Z",
    "end_date": "2026-02-13T11:00:00.000Z"
  }
}
```

### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–æ —Å–ø–∏—Å–∫–æ–º (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)

```json
{
  "success": true,
  "data": [
    { "id": 1, "title": "–ó–∞–¥–∞—á–∞ 1" },
    { "id": 2, "title": "–ó–∞–¥–∞—á–∞ 2" }
  ],
  "meta": {
    "page": 1,
    "limit": 20,
    "total": 156,
    "total_pages": 8
  }
}
```

### –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (400)

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö",
    "details": [
      {
        "field": "title",
        "message": "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ"
      },
      {
        "field": "event_date",
        "message": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã"
      }
    ]
  }
}
```

### –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (401)

```json
{
  "success": false,
  "error": {
    "code": "AUTHENTICATION_ERROR",
    "message": "–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –∏–ª–∏ –∏—Å—Ç—ë–∫—à–∏–π —Ç–æ–∫–µ–Ω"
  }
}
```

### –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (403)

```json
{
  "success": false,
  "error": {
    "code": "FORBIDDEN",
    "message": "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏"
  }
}
```

### –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω (404)

```json
{
  "success": false,
  "error": {
    "code": "NOT_FOUND",
    "message": "–°–æ–±—ã—Ç–∏–µ —Å id=42 –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
  }
}
```

### –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ (429)

```json
{
  "success": false,
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π. –î–æ—Å—Ç—É–ø–Ω–æ 50/–¥–µ–Ω—å –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º —Ç–∞—Ä–∏—Ñ–µ.",
    "details": {
      "limit": 50,
      "used": 50,
      "resets_at": "2026-02-13T00:00:00.000Z",
      "upgrade_url": "/api/v1/billing/checkout"
    }
  }
}
```

### –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (500)

```json
{
  "success": false,
  "error": {
    "code": "INTERNAL_ERROR",
    "message": "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
  }
}
```

### –°–ø–∏—Å–æ–∫ –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫

| –ö–æ–¥ | HTTP Status | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `VALIDATION_ERROR` | 400 | –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| `AUTHENTICATION_ERROR` | 401 | –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π/–∏—Å—Ç—ë–∫—à–∏–π —Ç–æ–∫–µ–Ω |
| `FORBIDDEN` | 403 | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ |
| `NOT_FOUND` | 404 | –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω |
| `CONFLICT` | 409 | –ö–æ–Ω—Ñ–ª–∏–∫—Ç (–¥—É–±–ª–∏–∫–∞—Ç username, email) |
| `RATE_LIMIT_EXCEEDED` | 429 | –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ |
| `EXTERNAL_SERVICE_ERROR` | 502 | –û—à–∏–±–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (Google, Yandex) |
| `INTERNAL_ERROR` | 500 | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ |

### HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è rate limiting

–ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏, –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É—é—â–∏–µ –æ –ª–∏–º–∏—Ç–∞—Ö:

```
X-RateLimit-Limit: 500
X-RateLimit-Remaining: 423
X-RateLimit-Reset: 1739404800
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

OAuth-—Ç–æ–∫–µ–Ω—ã (OAuthToken) —à–∏—Ñ—Ä—É—é—Ç—Å—è AES-256-GCM –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é –≤ –ë–î. –ö–ª—é—á
—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `TOKEN_ENCRYPTION_KEY` –∏ –Ω–∏–∫–æ–≥–¥–∞
–Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

```
// –°—Ö–µ–º–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
plaintext -> AES-256-GCM(key, iv) -> base64(iv + ciphertext + authTag) -> DB
DB -> base64decode -> AES-256-GCM-decrypt(key, iv, authTag) -> plaintext
```

### Prompt caching (Claude API)

–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∫—ç—à–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º `cache_control` –≤ Claude API. –ü—Ä–∏
–∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –ø–µ—Ä–≤—ã–π –±–ª–æ–∫ (`system prompt + tool definitions`) –º–∞—Ä–∫–∏—Ä—É–µ—Ç—Å—è
–∫–∞–∫ `ephemeral` -- Claude API –∫—ç—à–∏—Ä—É–µ—Ç –µ–≥–æ –Ω–∞ 5 –º–∏–Ω—É—Ç. –≠–∫–æ–Ω–æ–º–∏—è –¥–æ 90% –Ω–∞
–ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### Graceful shutdown

–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–∞ `SIGTERM`/`SIGINT`:
1. –ü—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –ø—Ä–∏—ë–º –Ω–æ–≤—ã—Ö HTTP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
2. –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (—Ç–∞–π–º–∞—É—Ç 30 —Å–µ–∫)
3. –ó–∞–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å PostgreSQL
4. –ó–∞–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Redis
5. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Telegram polling/webhook
6. –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å –∫–æ–¥–æ–º 0

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Winston —Å –¥–≤—É–º—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞–º–∏:
- **Console** (development): `colorize`, `simple` —Ñ–æ—Ä–º–∞—Ç
- **File** (production): JSON —Ñ–æ—Ä–º–∞—Ç, —Ä–æ—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑–º–µ—Ä—É (10MB), —Ö—Ä–∞–Ω–µ–Ω–∏–µ 14 –¥–Ω–µ–π

–ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `requestId` –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ —á–µ—Ä–µ–∑ –≤—Å–µ —Å–ª–æ–∏.

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ AI-—Ä–∞—Å—Ö–æ–¥–æ–≤

–ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ Claude API –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ CreditTransaction —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π:
- –ö–∞–∫–∞—è –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ (Haiku/Sonnet)
- –°–∫–æ–ª—å–∫–æ input/output —Ç–æ–∫–µ–Ω–æ–≤
- –°–∫–æ–ª—å–∫–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ —Å–ø–∏—Å–∞–Ω–æ
- –ö–∞–∫–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –º–æ–¥–µ–ª–µ–π
- –í—ã—è–≤–ª—è—Ç—å –∞–Ω–æ–º–∞–ª–∏–∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è
- –°—Ç—Ä–æ–∏—Ç—å –æ—Ç—á—ë—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (endpoint `GET /api/v1/billing/usage`)
